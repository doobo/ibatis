<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="vip.ipav.dao.DiscussMapper">
    <!-- 根据id获取用户信息 -->
    <select id="findDiscussByUid" parameterType="int" resultType="discuss">
        select * from discuss where user_id = #{id}
    </select>

    <!--通过对象查询,空对象时，会查询出所有的值-->
    <select id="findDiscussByUser" parameterType="user" resultType="discuss">
        select * from discuss
        <where>
            <if test="id!=null and id!=''">
                and user_id=#{id}
            </if>
        </where>
    </select>

    <!--数组查询，不查询User表的内容-->
    <select id="findDiscussByArray" parameterType="java.util.ArrayList" resultType="discuss">
        select * from discuss
        <where>
            <if test="array!=null">
            <foreach collection="array" index="index" item="item" open="and user_id in ("
                     separator="," close=")">
              #{item}
            </foreach>
            </if>
        </where>
    </select>

    <!--
        index：为数组的下标。
        item：为数组每个元素的名称，名称随意定义
        open：循环开始
        close：循环结束
        separator：中间分隔输出
    -->
    <select id="findDiscussByArray2" parameterType="Object[]" resultType="discuss">
        select * from discuss
        <where>
            <if test="array!=null">
            <foreach collection="array" index="index" item="item" open="and user_id in ("
                     separator="," close=")">
                #{item}
            </foreach>
            </if>
        </where>
    </select>

    <!-- 传递数组综合查询用户信息 -->
    <select id="selectUserByArray" parameterType="Object[]" resultType="discuss">
        select * from user
        <where>
            <!-- 传递数组 -->
            <if test="array!=null">
                <foreach collection="array" index="index" item="item" open="and user_id in (" separator = "," close= ")">
                    #{item.id}
                </foreach>
            </if>
        </where>
    </select>

    <!--关联查询1,自定义PoJo-->
    <select id="findDiscussList" resultType="vip.ipav.vo.DiscussInfo">
        SELECT
        discuss.*,
        user.id,
        user.username,
        user.address
        FROM
        discuss,user
        WHERE discuss.user_id = user.id
    </select>

    <!--关联查询2,List对象,一对一映射-->
    <select id="findDiscussResultMap" resultMap="discussMap">
        SELECT
        discuss.*,
        user.username,
        user.address
        FROM
        discuss,user
        WHERE discuss.user_id = user.id
    </select>
    <resultMap type="vip.ipav.po.Discuss" id="discussMap">
        <!-- 这里的id，是mybatis在进行一对一查询时将user字段映射为user对象时要使用，必须写 -->
        <id property="id" column="id"/>
        <result property="commit" column="commit"/>
        <result property="createTime" column="createTime"/>
        <association property="user" javaType="vip.ipav.po.User">
            <!-- 这里的id为user的id，如果写上表示给user的id属性赋值 -->
            <id property="id" column="user_id"/>
            <result property="username" column="username"/>
            <result property="address" column="address"/>
        </association>
    </resultMap>


</mapper>

